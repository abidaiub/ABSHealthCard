@using ABShealthcard.Doctors
@using Microsoft.AspNetCore.Components
@inject DoctorAiFeedbackAppService FeedbackService

<h4>AI Summary Feedback</h4>

<p>Was this AI summary helpful?</p>

<button class="btn btn-success me-2" @onclick="() => Submit(true)">üëç Helpful</button>
<button class="btn btn-danger" @onclick="() => Submit(false)">üëé Not Helpful</button>

@if (showComment)
{
    <div class="mt-3">
        <textarea class="form-control" @bind="comment" placeholder="Optional comment"></textarea>
        <button class="btn btn-primary mt-2" @onclick="SubmitComment">Submit</button>
    </div>
}

@code {
    [Parameter] public Guid PatientId { get; set; }

    bool showComment;
    string comment = string.Empty;

    async Task Submit(bool helpful)
    {
        showComment = true;
        await FeedbackService.SubmitAsync(PatientId, helpful, null);
    }

    async Task SubmitComment()
    {
        await FeedbackService.SubmitAsync(PatientId, false, comment);
        showComment = false;
        comment = string.Empty;
    }
}

// Future:
// - Aggregate feedback per prompt version
// - Show feedback stats to admins
// - Auto-disable AI on negative trend
